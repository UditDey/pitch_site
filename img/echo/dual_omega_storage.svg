<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1150 815" width="1150" height="815">
  <style>
    .boundary { fill: none; stroke: #000; stroke-width: 1.2; }
    .system-boundary { fill: none; stroke: #000; stroke-width: 1.5; }
    .switch { fill: none; stroke: #000; stroke-width: 1; }
    .line { fill: none; stroke: #000; stroke-width: 0.8; }
    .node { fill: #000; }
    .label { font-family: system-ui, -apple-system, sans-serif; font-size: 11px; fill: #000; }
    .shuffle-region { fill: none; stroke: #555; stroke-width: 1; stroke-dasharray: 6,3; }
    .storage-box { fill: none; stroke: #000; stroke-width: 1.2; }
    .title-label { font-family: system-ui, -apple-system, sans-serif; font-size: 24px; fill: #000; font-weight: bold; }
    .arrow-line { fill: none; stroke: #000; stroke-width: 4; }
    .conn-arrow-line { fill: none; stroke: #000; stroke-width: 1; }
    .arrowhead { fill: #000; }
    .conn-arrowhead { fill: #000; }
    .arrow-label { font-family: system-ui, -apple-system, sans-serif; font-size: 14px; fill: #000; font-weight: bold; }
    .network-label { font-family: system-ui, -apple-system, sans-serif; font-size: 18px; fill: #000; font-weight: bold; }
    .box-label { font-family: system-ui, -apple-system, sans-serif; font-size: 16px; fill: #000; font-weight: bold; }
  </style>
  <rect class="system-boundary" x="80" y="130" width="990" height="565" rx="8"/>
  <text class="title-label" x="345.0" y="90" text-anchor="middle">Read Ports: Data (Out)</text>
  <text class="title-label" x="805.0" y="90" text-anchor="middle">Read Ports: Addresses (In)</text>
  <g id="external-data-io">
    <path class="line" d="M210,110 L210,130"/>
    <path class="line" d="M240,110 L240,130"/>
    <path class="line" d="M290,110 L290,130"/>
    <path class="line" d="M320,110 L320,130"/>
    <path class="line" d="M370,110 L370,130"/>
    <path class="line" d="M400,110 L400,130"/>
    <path class="line" d="M450,110 L450,130"/>
    <path class="line" d="M480,110 L480,130"/>
  </g>
  <g id="external-address-io">
    <path class="line" d="M670,110 L670,130"/>
    <path class="line" d="M700,110 L700,130"/>
    <path class="line" d="M750,110 L750,130"/>
    <path class="line" d="M780,110 L780,130"/>
    <path class="line" d="M830,110 L830,130"/>
    <path class="line" d="M860,110 L860,130"/>
    <path class="line" d="M910,110 L910,130"/>
    <path class="line" d="M940,110 L940,130"/>
  </g>
  <g id="system-data-inputs">
    <circle class="node" cx="210" cy="130" r="4"/>
    <circle class="node" cx="240" cy="130" r="4"/>
    <circle class="node" cx="290" cy="130" r="4"/>
    <circle class="node" cx="320" cy="130" r="4"/>
    <circle class="node" cx="370" cy="130" r="4"/>
    <circle class="node" cx="400" cy="130" r="4"/>
    <circle class="node" cx="450" cy="130" r="4"/>
    <circle class="node" cx="480" cy="130" r="4"/>
  </g>
  <g id="system-address-inputs">
    <circle class="node" cx="670" cy="130" r="4"/>
    <circle class="node" cx="700" cy="130" r="4"/>
    <circle class="node" cx="750" cy="130" r="4"/>
    <circle class="node" cx="780" cy="130" r="4"/>
    <circle class="node" cx="830" cy="130" r="4"/>
    <circle class="node" cx="860" cy="130" r="4"/>
    <circle class="node" cx="910" cy="130" r="4"/>
    <circle class="node" cx="940" cy="130" r="4"/>
  </g>
  <rect class="storage-box" x="185" y="170.0" width="780" height="60" rx="4"/>
  <text class="box-label" x="575.0" y="205.0" text-anchor="middle">Retry Logic</text>
  <g id="data-to-retry">
    <path class="line" d="M210,134 L210,170.0"/>
    <path class="line" d="M240,134 L240,170.0"/>
    <path class="line" d="M290,134 L290,170.0"/>
    <path class="line" d="M320,134 L320,170.0"/>
    <path class="line" d="M370,134 L370,170.0"/>
    <path class="line" d="M400,134 L400,170.0"/>
    <path class="line" d="M450,134 L450,170.0"/>
    <path class="line" d="M480,134 L480,170.0"/>
  </g>
  <g id="address-to-retry">
    <path class="line" d="M670,134 L670,170.0"/>
    <path class="line" d="M700,134 L700,170.0"/>
    <path class="line" d="M750,134 L750,170.0"/>
    <path class="line" d="M780,134 L780,170.0"/>
    <path class="line" d="M830,134 L830,170.0"/>
    <path class="line" d="M860,134 L860,170.0"/>
    <path class="line" d="M910,134 L910,170.0"/>
    <path class="line" d="M940,134 L940,170.0"/>
  </g>
  <g id="data-connections">
    <path class="line" d="M210,230.0 L210,270"/>
    <path class="line" d="M240,230.0 L240,270"/>
    <path class="line" d="M290,230.0 L290,270"/>
    <path class="line" d="M320,230.0 L320,270"/>
    <path class="line" d="M370,230.0 L370,270"/>
    <path class="line" d="M400,230.0 L400,270"/>
    <path class="line" d="M450,230.0 L450,270"/>
    <path class="line" d="M480,230.0 L480,270"/>
  </g>
  <g id="address-connections">
    <path class="line" d="M670,230.0 L670,270"/>
    <path class="line" d="M700,230.0 L700,270"/>
    <path class="line" d="M750,230.0 L750,270"/>
    <path class="line" d="M780,230.0 L780,270"/>
    <path class="line" d="M830,230.0 L830,270"/>
    <path class="line" d="M860,230.0 L860,270"/>
    <path class="line" d="M910,230.0 L910,270"/>
    <path class="line" d="M940,230.0 L940,270"/>
  </g>
  <rect x="185" y="270" width="320" height="310" rx="6" fill="rgba(180, 210, 255, 0.35)" stroke="none"/>
  <rect class="boundary" x="185" y="270" width="320" height="310" rx="6"/>
  <g id="left-inputs">
    <circle class="node" cx="210" cy="270" r="4"/>
    <circle class="node" cx="240" cy="270" r="4"/>
    <circle class="node" cx="290" cy="270" r="4"/>
    <circle class="node" cx="320" cy="270" r="4"/>
    <circle class="node" cx="370" cy="270" r="4"/>
    <circle class="node" cx="400" cy="270" r="4"/>
    <circle class="node" cx="450" cy="270" r="4"/>
    <circle class="node" cx="480" cy="270" r="4"/>
  </g>
  <g id="left-input-wires" opacity="0.4">
    <path class="line" d="M210,274 L210,310"/>
    <path class="line" d="M240,274 L240,310"/>
    <path class="line" d="M290,274 L290,310"/>
    <path class="line" d="M320,274 L320,310"/>
    <path class="line" d="M370,274 L370,310"/>
    <path class="line" d="M400,274 L400,310"/>
    <path class="line" d="M450,274 L450,310"/>
    <path class="line" d="M480,274 L480,310"/>
  </g>
  <g id="left-stage1" opacity="0.4">
    <rect class="switch" x="195" y="310" width="60" height="40" rx="4"/>
    <rect class="switch" x="275" y="310" width="60" height="40" rx="4"/>
    <rect class="switch" x="355" y="310" width="60" height="40" rx="4"/>
    <rect class="switch" x="435" y="310" width="60" height="40" rx="4"/>
  </g>
  <g id="left-stage1-to-shuffle" opacity="0.4">
    <path class="line" d="M210,350 L210,365"/>
    <path class="line" d="M240,350 L240,365"/>
    <path class="line" d="M290,350 L290,365"/>
    <path class="line" d="M320,350 L320,365"/>
    <path class="line" d="M370,350 L370,365"/>
    <path class="line" d="M400,350 L400,365"/>
    <path class="line" d="M450,350 L450,365"/>
    <path class="line" d="M480,350 L480,365"/>
  </g>
  <rect class="shuffle-region" x="195" y="365" width="300" height="25" rx="4"/>
  <g id="left-shuffle-to-stage2" opacity="0.4">
    <path class="line" d="M210,390 L210,405"/>
    <path class="line" d="M240,390 L240,405"/>
    <path class="line" d="M290,390 L290,405"/>
    <path class="line" d="M320,390 L320,405"/>
    <path class="line" d="M370,390 L370,405"/>
    <path class="line" d="M400,390 L400,405"/>
    <path class="line" d="M450,390 L450,405"/>
    <path class="line" d="M480,390 L480,405"/>
  </g>
  <g id="left-stage2" opacity="0.4">
    <rect class="switch" x="195" y="405" width="60" height="40" rx="4"/>
    <rect class="switch" x="275" y="405" width="60" height="40" rx="4"/>
    <rect class="switch" x="355" y="405" width="60" height="40" rx="4"/>
    <rect class="switch" x="435" y="405" width="60" height="40" rx="4"/>
  </g>
  <g id="left-stage2-to-shuffle" opacity="0.4">
    <path class="line" d="M210,445 L210,460"/>
    <path class="line" d="M240,445 L240,460"/>
    <path class="line" d="M290,445 L290,460"/>
    <path class="line" d="M320,445 L320,460"/>
    <path class="line" d="M370,445 L370,460"/>
    <path class="line" d="M400,445 L400,460"/>
    <path class="line" d="M450,445 L450,460"/>
    <path class="line" d="M480,445 L480,460"/>
  </g>
  <rect class="shuffle-region" x="195" y="460" width="300" height="25" rx="4"/>
  <g id="left-shuffle-to-stage3" opacity="0.4">
    <path class="line" d="M210,485 L210,500"/>
    <path class="line" d="M240,485 L240,500"/>
    <path class="line" d="M290,485 L290,500"/>
    <path class="line" d="M320,485 L320,500"/>
    <path class="line" d="M370,485 L370,500"/>
    <path class="line" d="M400,485 L400,500"/>
    <path class="line" d="M450,485 L450,500"/>
    <path class="line" d="M480,485 L480,500"/>
  </g>
  <g id="left-stage3" opacity="0.4">
    <rect class="switch" x="195" y="500" width="60" height="40" rx="4"/>
    <rect class="switch" x="275" y="500" width="60" height="40" rx="4"/>
    <rect class="switch" x="355" y="500" width="60" height="40" rx="4"/>
    <rect class="switch" x="435" y="500" width="60" height="40" rx="4"/>
  </g>
  <g id="left-output-wires" opacity="0.4">
    <path class="line" d="M210,540 L210,576"/>
    <path class="line" d="M240,540 L240,576"/>
    <path class="line" d="M290,540 L290,576"/>
    <path class="line" d="M320,540 L320,576"/>
    <path class="line" d="M370,540 L370,576"/>
    <path class="line" d="M400,540 L400,576"/>
    <path class="line" d="M450,540 L450,576"/>
    <path class="line" d="M480,540 L480,576"/>
  </g>
  <g id="left-outputs">
    <circle class="node" cx="210" cy="580" r="4"/>
    <circle class="node" cx="240" cy="580" r="4"/>
    <circle class="node" cx="290" cy="580" r="4"/>
    <circle class="node" cx="320" cy="580" r="4"/>
    <circle class="node" cx="370" cy="580" r="4"/>
    <circle class="node" cx="400" cy="580" r="4"/>
    <circle class="node" cx="450" cy="580" r="4"/>
    <circle class="node" cx="480" cy="580" r="4"/>
  </g>
  <rect x="645" y="270" width="320" height="310" rx="6" fill="rgba(255, 200, 180, 0.35)" stroke="none"/>
  <rect class="boundary" x="645" y="270" width="320" height="310" rx="6"/>
  <g id="right-inputs">
    <circle class="node" cx="670" cy="270" r="4"/>
    <circle class="node" cx="700" cy="270" r="4"/>
    <circle class="node" cx="750" cy="270" r="4"/>
    <circle class="node" cx="780" cy="270" r="4"/>
    <circle class="node" cx="830" cy="270" r="4"/>
    <circle class="node" cx="860" cy="270" r="4"/>
    <circle class="node" cx="910" cy="270" r="4"/>
    <circle class="node" cx="940" cy="270" r="4"/>
  </g>
  <g id="right-input-wires" opacity="0.4">
    <path class="line" d="M670,274 L670,310"/>
    <path class="line" d="M700,274 L700,310"/>
    <path class="line" d="M750,274 L750,310"/>
    <path class="line" d="M780,274 L780,310"/>
    <path class="line" d="M830,274 L830,310"/>
    <path class="line" d="M860,274 L860,310"/>
    <path class="line" d="M910,274 L910,310"/>
    <path class="line" d="M940,274 L940,310"/>
  </g>
  <g id="right-stage1" opacity="0.4">
    <rect class="switch" x="655" y="310" width="60" height="40" rx="4"/>
    <rect class="switch" x="735" y="310" width="60" height="40" rx="4"/>
    <rect class="switch" x="815" y="310" width="60" height="40" rx="4"/>
    <rect class="switch" x="895" y="310" width="60" height="40" rx="4"/>
  </g>
  <g id="right-stage1-to-shuffle" opacity="0.4">
    <path class="line" d="M670,350 L670,365"/>
    <path class="line" d="M700,350 L700,365"/>
    <path class="line" d="M750,350 L750,365"/>
    <path class="line" d="M780,350 L780,365"/>
    <path class="line" d="M830,350 L830,365"/>
    <path class="line" d="M860,350 L860,365"/>
    <path class="line" d="M910,350 L910,365"/>
    <path class="line" d="M940,350 L940,365"/>
  </g>
  <rect class="shuffle-region" x="655" y="365" width="300" height="25" rx="4"/>
  <g id="right-shuffle-to-stage2" opacity="0.4">
    <path class="line" d="M670,390 L670,405"/>
    <path class="line" d="M700,390 L700,405"/>
    <path class="line" d="M750,390 L750,405"/>
    <path class="line" d="M780,390 L780,405"/>
    <path class="line" d="M830,390 L830,405"/>
    <path class="line" d="M860,390 L860,405"/>
    <path class="line" d="M910,390 L910,405"/>
    <path class="line" d="M940,390 L940,405"/>
  </g>
  <g id="right-stage2" opacity="0.4">
    <rect class="switch" x="655" y="405" width="60" height="40" rx="4"/>
    <rect class="switch" x="735" y="405" width="60" height="40" rx="4"/>
    <rect class="switch" x="815" y="405" width="60" height="40" rx="4"/>
    <rect class="switch" x="895" y="405" width="60" height="40" rx="4"/>
  </g>
  <g id="right-stage2-to-shuffle" opacity="0.4">
    <path class="line" d="M670,445 L670,460"/>
    <path class="line" d="M700,445 L700,460"/>
    <path class="line" d="M750,445 L750,460"/>
    <path class="line" d="M780,445 L780,460"/>
    <path class="line" d="M830,445 L830,460"/>
    <path class="line" d="M860,445 L860,460"/>
    <path class="line" d="M910,445 L910,460"/>
    <path class="line" d="M940,445 L940,460"/>
  </g>
  <rect class="shuffle-region" x="655" y="460" width="300" height="25" rx="4"/>
  <g id="right-shuffle-to-stage3" opacity="0.4">
    <path class="line" d="M670,485 L670,500"/>
    <path class="line" d="M700,485 L700,500"/>
    <path class="line" d="M750,485 L750,500"/>
    <path class="line" d="M780,485 L780,500"/>
    <path class="line" d="M830,485 L830,500"/>
    <path class="line" d="M860,485 L860,500"/>
    <path class="line" d="M910,485 L910,500"/>
    <path class="line" d="M940,485 L940,500"/>
  </g>
  <g id="right-stage3" opacity="0.4">
    <rect class="switch" x="655" y="500" width="60" height="40" rx="4"/>
    <rect class="switch" x="735" y="500" width="60" height="40" rx="4"/>
    <rect class="switch" x="815" y="500" width="60" height="40" rx="4"/>
    <rect class="switch" x="895" y="500" width="60" height="40" rx="4"/>
  </g>
  <g id="right-output-wires" opacity="0.4">
    <path class="line" d="M670,540 L670,576"/>
    <path class="line" d="M700,540 L700,576"/>
    <path class="line" d="M750,540 L750,576"/>
    <path class="line" d="M780,540 L780,576"/>
    <path class="line" d="M830,540 L830,576"/>
    <path class="line" d="M860,540 L860,576"/>
    <path class="line" d="M910,540 L910,576"/>
    <path class="line" d="M940,540 L940,576"/>
  </g>
  <g id="right-outputs">
    <circle class="node" cx="670" cy="580" r="4"/>
    <circle class="node" cx="700" cy="580" r="4"/>
    <circle class="node" cx="750" cy="580" r="4"/>
    <circle class="node" cx="780" cy="580" r="4"/>
    <circle class="node" cx="830" cy="580" r="4"/>
    <circle class="node" cx="860" cy="580" r="4"/>
    <circle class="node" cx="910" cy="580" r="4"/>
    <circle class="node" cx="940" cy="580" r="4"/>
  </g>
  <text class="network-label" x="173" y="425.0" text-anchor="middle" transform="rotate(-90 173 425.0)">Transfer Network</text>
  <text class="network-label" x="977" y="425.0" text-anchor="middle" transform="rotate(90 977 425.0)">Control Network</text>
  <path class="arrow-line" d="M110,580 L110,270"/>
  <polygon class="arrowhead" points="110,265 100,285 120,285"/>
  <path class="arrow-line" d="M1040,270 L1040,580"/>
  <polygon class="arrowhead" points="1040,585 1030,565 1050,565"/>
  <rect class="storage-box" x="185" y="605" width="320" height="60" rx="4"/>
  <text class="title-label" x="345.0" y="641.0" text-anchor="middle">Storage Array</text>
  <g id="storage-connections">
    <path class="line" d="M210,580 L210,605"/>
    <path class="line" d="M240,580 L240,605"/>
    <path class="line" d="M290,580 L290,605"/>
    <path class="line" d="M320,580 L320,605"/>
    <path class="line" d="M370,580 L370,605"/>
    <path class="line" d="M400,580 L400,605"/>
    <path class="line" d="M450,580 L450,605"/>
    <path class="line" d="M480,580 L480,605"/>
  </g>
  <path class="conn-arrow-line" d="M635,425.0 L515,425.0"/>
  <polygon class="conn-arrowhead" points="512,425.0 523,420.0 523,430.0"/>
  <text class="arrow-label" x="575.0" y="413.0" text-anchor="middle">Switch States</text>
  <path class="line" d="M670,595 L940,595"/>
  <g id="valid-bits-stubs">
    <path class="line" d="M670,580 L670,595"/>
    <path class="line" d="M700,580 L700,595"/>
    <path class="line" d="M750,580 L750,595"/>
    <path class="line" d="M780,580 L780,595"/>
    <path class="line" d="M830,580 L830,595"/>
    <path class="line" d="M860,580 L860,595"/>
    <path class="line" d="M910,580 L910,595"/>
    <path class="line" d="M940,580 L940,595"/>
  </g>
  <path class="conn-arrow-line" d="M805.0,595 L805.0,635.0 L520,635.0"/>
  <polygon class="conn-arrowhead" points="510,635.0 520,630.0 520,640.0"/>
  <text class="arrow-label" x="820.0" y="615.0" text-anchor="start">Valid Bits</text>
  <path class="line" d="M345.0,695 L345.0,715"/>
  <circle class="node" cx="345.0" cy="695" r="4"/>
  <path class="line" d="M345.0,665 L345.0,695"/>
  <text class="title-label" x="345.0" y="745" text-anchor="middle">Write Port</text>
</svg>